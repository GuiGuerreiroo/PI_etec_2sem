<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservas Lab</title>
  <!-- Bootstrap (apenas para o sistema de grid responsivo) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap-grid.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Link para a sua folha de estilo externa -->
  <link rel="stylesheet" href="../style/reservation.css">
</head>

<body>
  <div class="container">
    <h2>Reservas Laboratórios</h2>
    <div class="progress-wrapper">
      <div class="progress" id="progress-bar"></div>
    </div>

    <div class="row">
      <div class="">
        <!-- Calendário -->
        <div class="section">
          <div class="calendar-header">
            <button id="prev-month" class="nav-btn"><i class="bi bi-chevron-left"></i></button>
            <span id="month-year"></span>
            <button id="next-month" class="nav-btn"><i class="bi bi-chevron-right"></i></button>
          </div>
          <div class="calendar" id="calendar-days">
          </div>
        </div>
        <!-- <div class="section">
           
          <div class="label">Professores:</div>
          <div class="buttons" id="teacher-buttons">
            <button class="btn outline" data-value="Professor 1">Professor 1</button>
            <button class="btn outline" data-value="Professor 2">Professor 2</button>
            <button class="btn outline" data-value="Professor 3">Professor 3</button>
            <button class="btn outline" data-value="Professor"></button>
          </div>
        </div> -->

        <!-- Laboratórios -->
        <div class="section">
          <div class="label">Laboratórios:</div>
          <div class="buttons" id="lab-buttons">
            <button class="btn outline" data-value="Lab 01">Lab 01</button>
            <button class="btn outline" data-value="Lab 02">Lab 02</button>
            <button class="btn outline" data-value="Lab 03">Lab 03</button>
          </div>
        </div>

        <hr>

        <!-- Horários -->
        <div class="section" id="time-slots">
          <div class="label">Manhã:</div>
          <div class="buttons">
            <button class="btn outline" data-value="07h10-08h00">7h10-8h00</button>
            <button class="btn outline" data-value="08h00-08h50">8h00-8h50</button>
            <button class="btn outline" data-value="08h50-09h40">8h50-9h40</button>
            <button class="btn outline" data-value="10h00-10h50">10h00-10h50</button>
            <button class="btn outline" data-value="10h50-11h40">10h50-11h40</button>
            <button class="btn outline" data-value="11h40-12h30">11h40-12h30</button>
          </div>

          <div class="label">Tarde:</div>
          <div class="buttons">
            <button class="btn outline" data-value="13h00-13h50">13h00-13h50</button>
            <button class="btn outline" data-value="13h50-14h40">13h50-14h40</button>
            <button class="btn outline" data-value="14h40-15h30">14h40-15h30</button>
            <button class="btn outline" data-value="15h50-16h40">15h50-16h40</button>
            <button class="btn outline" data-value="16h40-17h30">16h40-17h30</button>
            <button class="btn outline" data-value="17h30-18h20">17h30-18h20</button>
          </div>
          <div class="label">Noite:</div>
          <div class="buttons">
            <button class="btn outline" data-value="18h50-20h44">18h50-20h44</button>
            <button class="btn outline" data-value="20h58-22h50">20h58-22h50</button>
          </div>
        </div>

        <hr>

        <!-- Kits -->
        <div class="section">
          <div class="label">Kits:</div>
          <div class="buttons" id="kit-buttons">
            <button class="btn outline" data-value="Kit 01">Kit 01</button>
            <button class="btn outline" data-value="Kit 02">Kit 02</button>
            <button class="btn outline" data-value="Kit 03">Kit 03</button>
            <button class="btn outline" data-value="Adicional">+</button>
          </div>
        </div>
      </div>

      <div class="">
        <!-- Informações -->
        <div class="info-box">
          <div class="label title">INFORMAÇÕES</div>
          <div class="info-item"><strong>Professor:</strong><span id="info-professor">Joao Carlos</span></div>
          <div class="info-item"><strong>Data:</strong><span id="info-data">--</span></div>
          <div class="info-item"><strong>Laboratório:</strong><span id="info-lab">--</span></div>
          <div class="info-item"><strong>Horário:</strong><span id="info-horario">--</span></div>
          <div class="info-item"><strong>Kits:</strong><span id="info-kits">--</span></div>
          <button class="concluir-btn">Concluir</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Estado da aplicação
      const state = {
        selectedDate: new Date(),
        // selectedTeacher: null,
        selectedLab: null,
        selectedTime: null,
        selectedKit: null,
      };

      // Elementos do DOM
      const monthYearEl = document.getElementById('month-year');
      const calendarDaysEl = document.getElementById('calendar-days');
      const prevMonthBtn = document.getElementById('prev-month');
      const nextMonthBtn = document.getElementById('next-month');

      const infoDateEl = document.getElementById('info-data');
      // const infoTeacherEl = document.getElementById('info-professor');
      const infoLabEl = document.getElementById('info-lab');
      const infoHorarioEl = document.getElementById('info-horario');
      const infoKitsEl = document.getElementById('info-kits');

      const labButtonsContainer = document.getElementById('lab-buttons');
      // const teacherButtonsContainer = document.getElementById('teacher-buttons');
      const timeSlotsContainer = document.getElementById('time-slots');
      const kitButtonsContainer = document.getElementById('kit-buttons');
      const progressBar = document.getElementById('progress-bar');

      const weekdays = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];

      function renderCalendar() {
        calendarDaysEl.innerHTML = '';
        const date = new Date(state.selectedDate);
        const month = date.getMonth();
        const year = date.getFullYear();

        monthYearEl.textContent = date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });

        const firstDayOfMonth = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        // Adiciona os dias da semana
        weekdays.forEach(day => {
          const dayEl = document.createElement('div');
          dayEl.classList.add('weekday');
          dayEl.textContent = day;
          calendarDaysEl.appendChild(dayEl);
        });

        // Adiciona células vazias
        for (let i = 0; i < firstDayOfMonth; i++) {
          const emptyCell = document.createElement('div');
          emptyCell.style.cursor = 'default';
          emptyCell.style.background = 'transparent';
          calendarDaysEl.appendChild(emptyCell);
        }

        // Adiciona os dias do mês
        for (let i = 1; i <= daysInMonth; i++) {
          const dayEl = document.createElement('div');
          dayEl.textContent = i;
          dayEl.dataset.day = i;

          const today = new Date();
          const currentDate = new Date(year, month, i);

          if (currentDate < new Date(today.getFullYear(), today.getMonth(), today.getDate())) {
            dayEl.classList.add('disabled');
          }

          if (i === state.selectedDate.getDate() && month === state.selectedDate.getMonth() && year === state.selectedDate.getFullYear()) {
            dayEl.classList.add('selected');
          }
          calendarDaysEl.appendChild(dayEl);
        }
        updateInfo();
      }

      function updateInfo() {
        infoDateEl.textContent = state.selectedDate.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        // infoTeacherEl.textContent = state.selectedTeacher || '--';
        infoLabEl.textContent = state.selectedLab || '--';
        infoHorarioEl.textContent = state.selectedTime || '--';
        infoKitsEl.textContent = state.selectedKit || '--';
        updateProgress();
      }

      function updateProgress() {
        let completedSteps = 0;
        if (state.selectedDate) completedSteps++;
        // if (state.selectedTeacher) completedSteps++;
        if (state.selectedLab) completedSteps++;
        if (state.selectedTime) completedSteps++;
        if (state.selectedKit) completedSteps++;

        const progressPercentage = (completedSteps / 4) * 100;
        progressBar.style.width = `${progressPercentage}%`;
      }

      function handleSelection(container, stateKey, isSingleSelection = true) {
        container.addEventListener('click', e => {
          const button = e.target.closest('button');
          if (!button) return;

          if (isSingleSelection) {
            // Remove a seleção de todos os botões no grupo
            container.querySelectorAll('button').forEach(btn => {
              btn.classList.add('outline');
            });
            // Adiciona a seleção ao botão clicado
            button.classList.remove('outline');
            state[stateKey] = button.dataset.value;
          }
          updateInfo();
        });
      }
      // --- Event Listeners ---
      prevMonthBtn.addEventListener('click', () => {
        state.selectedDate.setDate(1); // Evita pular meses
        state.selectedDate.setMonth(state.selectedDate.getMonth() - 1);
        renderCalendar();
      });

      nextMonthBtn.addEventListener('click', () => {
        state.selectedDate.setDate(1); // Evita pular meses
        state.selectedDate.setMonth(state.selectedDate.getMonth() + 1);
        renderCalendar();
      });

      calendarDaysEl.addEventListener('click', (e) => {
        const dayEl = e.target;
        if (dayEl.dataset.day && !dayEl.classList.contains('disabled')) {
          const day = parseInt(dayEl.dataset.day, 10);
          state.selectedDate.setDate(day);
          renderCalendar();
        }
      });

      // handleSelection(teacherButtonsContainer, 'selectedTeacher');
      handleSelection(labButtonsContainer, 'selectedLab');
      handleSelection(timeSlotsContainer, 'selectedTime');
      handleSelection(kitButtonsContainer, 'selectedKit');

      // Inicialização
      renderCalendar();
    });
  </script>
  <div vw class="enabled">
    <div vw-access-button class="active"></div>
    <div vw-plugin-wrapper>
      <div class="vw-plugin-top-wrapper"></div>
    </div>
  </div>
  <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
  <script>
    new window.VLibras.Widget('https://vlibras.gov.br/app')
  </script>
  </script>
</body>

</html>